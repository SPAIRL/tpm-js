<h2>Cryptographic Keys</h2>

<p>TPM can generate strong, secure cryptographic keys. Strong in the sense that the key is derived from a true random source and a large key space. Secure in the sense that the private key material never leaves the TPM secure boundaries in plain form. Since TPM is a very small device, we can not store the keys directly onto it. Therefore, every key generated by a TPM is encrypted by its parent key, forming a tree with a root at a special key known as the primary key. The primary key is derived from two sources: the seed for the hierarchy (more about hierarchy's in the next section) and the template.<p>

<p>
  <img src="images/key_tree.svg" class="img-responsive center-block" style="max-width:70%"
    alt="Key Tree">
</p>

<h3>Key Hierarchies</h3>
<p>
  TPM uses a key hierarchy system to organize and protect cryptographic keys and other sensitive data. A key hierarchy is a logical collection of entities that differ by when their seeds are created and by who certifies their primary keys. TPM has four key hierarchies: 
  <ol>
    <li>Endorsement hierarchy.</li>
    <li>Platform hierarchy.</li>
    <li>Owner hierarchy, also known as storage hierarchy.</li>
    <li>Null hierarchy.</li>
  </ol>
  <p>
  The Endorsement hierarchy is created and certified by the TPM manufacturer. It is used to store objects created and certified by the TPM manufacturer, such as the primary endorsement key. This key is used to identify the device and can also be used as the machine's identity.
  </p>
  <p>  
  The Platform hierarchy is created and certified by the Original Equipment Manufacturer (OEM) that builds the host platform. It is used to store objects created and certified by the OEM, such as the platform seed. The platform seed can be changed by the OEM if needed.
  </p>
  <p>
  The Owner hierarchy is used by the primary users of the TPM, such as the IT department of an organization. When a user takes ownership, the owner hierarchy is reset, and two user keys are provisioned and certified by the owner. These two keys form the root of trust for all the keys generated on the owner hierarchy.
  </p>
  <p>
  The Null hierarchy is used to store ephemeral keys that are created and destroyed each time the host reboots. The null seed is regenerated each time the host reboots.
  </p>
  <p>
  Overall, the key hierarchy system helps organize and protect cryptographic keys and other sensitive data on the TPM. Understanding the different hierarchies and their purposes is crucial for effective and secure use of the TPM.
  </p>
</p>

<h3>Primary Keys</h3>
<p>
  As mentioned, primary keys are derived from the primary seeds using a deterministic
  key derivation function (KDF). More accurately, the KDF takes as input the fixed
  seed and the key's template that describes its properties.
</p>

<p>
  <img src="images/kdf.svg" class="img-responsive center-block" style="max-width:70%"
    alt="KDF">
  <br>
  <div class="alert alert-info" role="alert">If either the seed or the template changes, a completely different primary key
    is created</div>
</p>

<p>
  Important fields of the template include the <i>type</i> that describes whether this is a symmetric or
  asymmetric key, the <i>objectAttributes</i> that describes whether the key is
  used for encryption or signing, the <i>parameters</i> that describes the key
  size and <i>unique</i> that is used as an entropy value.
  <br>
  <div class="alert alert-info" role="alert">By changing the entropy field, 
    the TPM can generate an unlimited number of primary
    keys of a given type (say RSA-2048).</div>
</p>

<h3>Child Keys</h3>

<p>
  A hierarchy can be thought of as having parent and child keys. Parent keys protect
  its children, offering secrecy and integrity when the child key is stored outside
  the TPM. Keys that wrap other keys are also called <em>storage keys</em>. Storage
  keys are restricted encryption keys. They cannot be used for general decryption,
  which could then leak the child's secrets.

  <br> The ultimate parent at the top of the hierarchy is a primary key. Children
  can be storage keys, in which case they can also be parents. Children can also
  be non-storage keys, in which case they're leaf keys: children but never parents.
</p>
